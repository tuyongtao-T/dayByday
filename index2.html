<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="JS文件/20.ajax封装.js" type="text/javascript" charset="utf-8"></script>
		<script src="JS文件/21.my-1.0.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<button>
			发送求情
		</button>
		<script type="text/javascript">
			var div = document.getElementsByTagName('button')[0];
			div.onclick = function() {
				myAjax({
					type: 'get',
					url: 'ajax2.json',
					dataType: '',
					timeout: 3000,
					data: {
						username: 'tyt',
						password: '12345'
					},
					fnS: function(str) {
						console.log(str.responseText);
					},
					fnE: function() {
						console.log("资源不存在");
					}
				})
			}

			function myAjax(obj) {
				var xhr,
					timer,
					dataStr = datatoStr(obj.data);
				if(window.XMLHttpRequest) {
					xhr = new XMLHttpRequest();
				} else {
					xhr = new ActiveXObject('Microsoft.XMLHTTP');
				}
				if(obj.type.toLowerCase() === 'get') {
					xhr.open('GET', obj.url + '?' + dataStr, true);
					xhr.send();
				} else {
					xhr.open('POST', obj.url, true);
					xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					xhr.send(dataStr);
				}
				if(xhr.readyState === '4') {
					if(xhr.status >= 200 && xhr.status < 300 || xhr.status === 304) {
						obj.fnS(xhr)
					} else {
						console.log("错误码" + xhr.status);
					}
				}
				if(obj.timeout) {
					setInterval(function() {
						xhr.abort();
						clearInterval(timer);
					}, obj.timeout);
				}

			}

			function datatoStr(data) {
				var arr = [];
				data.t = new Date().getTime();
				for(key in data) {
					arr.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]));
				}
				return arr.join('&');
			}
		</script>

		<div id="d0" style="width: 300px; height: 300px; background: pink; margin: 50px;">
			<div id="d1" style="width: 200px; height: 200px; background: red;margin-left: 50px;">
				<div id="d2" style="width: 100px; height: 100px; background:blue;">

				</div>
			</div>
		</div>
		<script type="text/javascript">
			T('#d0').addEvent('click', function(e) {
				console.log('d0')
			});
			T('#d1').addEvent('click', function(e) {
				console.log('d1')
				e.stopBubble();
			});
			T('#d2').addEvent('click', function(e) {
				var e = e || window.event,
					tar = e.target || e.srcElement;
				e.stopBubble();
				console.log('d2');
			});
			var filter = function(node) {
				return node.nodeName.toLowerCase() == "div" ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
			}
			var iterator = document.createNodeIterator(T('#d0'), NodeFilter.SHOW_ALL, filter);
			var node = iterator.nextNode();
			console.log(node); //HTMLHeadingElement
		</script>
	</body>

</html>